<div>
	
	<table id="allCustomer" class="easyui-datagrid" style="width:100%;height:500px;" toolbar="#customerToolBar"
	 data-options="pagination:true,singleSelect:true,collapsible:false,loader:myloader,
		method:'get',fitColumns:true, nowrap:true,pageList:[5,10,15,20],pageSize:5,displayMsg:''">
		<thead>
			<tr>
				<th data-options="field:'customerNo',width:80,align:'center',resizable:false">客户编号</th>
				<th data-options="field:'customerName',width:100, align:'center',resizable:false">客户名称</th>
				<th data-options="field:'customerAddress',width:250,align:'center',resizable:false">客户地址</th>
				<th data-options="field:'customerEmail',width:80,align:'center',resizable:false">客户邮箱</th>
				<th data-options="field:'customerRegion',width:80, align:'center',resizable:false">客户区域</th>
				<th data-options="field:'customerPhone',width:60,align:'center',resizable:false">客户电话</th>
				<th data-options="field:'customerCooperation',width:60,align:'center',resizable:false">合作关系</th>
				<th data-options="field:'customerGrade',width:60,align:'center',resizable:false">VIP级别</th>
				<th data-options="field:'customerCredit',width:60,align:'center',resizable:false">信用级别</th>
				<th data-options="field:'customerSatisfaction',width:60,align:'center',resizable:false">满意度</th>
				<th data-options="field:'customerStatus',width:60,align:'center',resizable:false">状态</th>
			</tr>
		</thead>
	</table>

	<!-- 用户列表工具栏 -->
	<div id="customerToolBar" style="height:auto">
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-cancel',plain:true" onclick="">删除客户</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true" onclick="">修改客户信息</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-search',plain:true" onclick="">查看客户联系人</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-search',plain:true" onclick="checkRecord()">交往记录</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-search',plain:true" onclick="">查看客户联系人</a>
	</div>


	<!-- 交往记录工具栏 -->
	<div id="recordToolBar" style="height:auto">
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-cancel',plain:true" onclick="removeRecord()">删除记录</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true" onclick="updateRecord()">修改记录</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" onclick="pachRecord()">添加记录</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-search',plain:true" onclick="clearRecord()">清空记录</a>
	</div>

	<!--点击查看交往记录弹出的对话框-->
	<div id="showRecord" class="easyui-dialog" title="客户交往记录" data-options="iconCls:'icon-search',closed:true" style="width:880px;"
	 style="overflow: auto;">
		<table id="allRecord" class="easyui-datagrid" style="width:100%;height:500px;" toolbar="#recordToolBar" data-options="pagination:true,singleSelect:true,collapsible:false,method:'get',fitColumns:true, nowrap:true,pageList:[5,10,15,20],pageSize:5">
			<thead>
				<tr>
					<!-- 	<th data-options="field:'customerNo',width:100,align:'center',resizable:false">客户编号</th> -->
					<th data-options="field:'customerName',width:100,align:'center',resizable:false">客户姓名</th>
					<!-- <th data-options="field:'userNo',width:100,align:'center',resizable:false">处理人编号</th> -->
					<th data-options="field:'handlerName',width:100,align:'center',resizable:false">处理人姓名</th>
					<th data-options="field:'createTime',width:100,align:'center',resizable:false">时间</th>
					<th data-options="field:'chatAddress',width:100,align:'center',resizable:false">地点</th>
					<th data-options="field:'shortDescription',width:170,align:'center',resizable:false">概要</th>
					<th data-options="field:'longDescription',width:170,align:'center',resizable:false">详细信息</th>
					<th data-options="field:'moreInfo',width:170,align:'center',resizable:false">备注</th>
				</tr>
			</thead>
		</table>
	</div>
	
	<!-- 点击修改 交往记录弹出的对话框-->
	<div id="updateRecord" class="easyui-dialog" title="修改交往记录" data-options="iconCls:'icon-search',closed:true">
		<div class="easyui-panel" style="width:400px;border-style: none;">
			<div style="padding:10px 60px 20px 60px;">
				<form id="tbUpdateRecord" data-options="novalidate:true" class="easyui-form">
					<table cellpadding="5">
						<tr>
							<td>客户姓名:</td>
							<td><input class="easyui-textbox" type="text" name="customerName" data-options="required:true" style="width: 160px;"></input>
							</td>
						</tr>
						<tr>
							<td>客处理人姓名:</td>
							<td><input class="easyui-textbox" type="text" name="handlerName" data-options="required:true," style="width: 160px;"></input>
							</td>
						</tr>
						<tr>
							<td>时间:</td>
							<td><input class="easyui-textbox" type="text" name="createTime" data-options="required:true," style="width: 160px;"></input>
							</td>
						</tr>
						<tr>
							<td>地点:</td>
							<td><input class="easyui-textbox" type="text" name="chatAddress" data-options="required:true," style="width: 160px;"></input>
							</td>
						</tr>
						<tr>
							<td>概要:</td>
							<td><input class="easyui-textbox" type="text" name="shortDescription" data-options="required:true," style="width: 160px;"></input>
							</td>
						</tr>
						<tr>
							<td>详细信息:</td>
							<td><input class="easyui-textbox" type="text" name="longDescription" data-options="required:true," style="width: 160px;"></input>
							</td>
						</tr>
						<tr>
							<td>备注:</td>
							<td><input class="easyui-textbox" type="text" name="moreInfo" data-options="required:true," style="width: 160px;"></input>
							</td>
						</tr>
					</table>
				</form>
				<div style="text-align:center;padding:5px">
					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitRecordForm()" style="margin-right: 20%;">提交</a>
					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="cancleRecordForm()">取消</a>
				</div>
			</div>
		</div>
	</div>
	
	
	
	<!-- 点击新增交往记录弹出的对话框 -->
	
	<div id="">
		
	</div>
	
</div>

<script type="text/javascript">
	var myloader = function(param, success, error) {
		$.ajax({
			type: "GET",
			url: "http://localhost:8080/customer/" + param.page + "/" + param.rows,
			success: function(data) {
				var obj = {};
				obj.total = data.total;
				obj.rows = data.data;
				success(obj);
			}
		});
	}

	function recordLoader(param, success, error) {
		var cusId = $("#allCustomer").datagrid("getSelected").customerId;
		$.ajax({
			type: "GET",
			url: "http://localhost:8080/chatRecord/" + param.page + "/" + param.rows + "/" + cusId,
			success: function(data) {
				var obj = {}
				obj.total = data.total;
				obj.rows = data.data;
				success(obj)
			}
		});
	}
	 
	function checkRecord() {
		var f = $("#allCustomer").datagrid("getSelected");
		if (f) {
			$('#showRecord').dialog('open');
			$('#allRecord').datagrid({
				loader: recordLoader
			});
		} else {
			$.messager.alert("提示", "没有选中行")
		}
	}

	function removeRecord() {
		var f = $('#allRecord').datagrid("getSelected");
		if (f) {
			var b = f.chatId;
			$.ajax({
				type: "DELETE",
				url: "http://localhost:8080/chatRecord/" + b,
				success: function(data) {
					$('#allRecord').datagrid('reload');
					$.messager.alert("提示", data.msg)
				}
			})
		} else {
			$.messager.alert("提示", "没有选中行")
		}

	}

	function updateRecord(){
		var f = $('#allRecord').datagrid("getSelected");
		if (f) {
			$('#updateRecord').dialog('open');
			$('#showRecord').dialog('close');
			$('#tbUpdateRecord').form("load",f);		
		} else {
			$.messager.alert("提示", "没有选中行")
		}
	}
	
	function pachRecord(){
		
	}
	
	function clearRecord(){
		
	}
	
	function submitRecordForm(){
		$('#tbUpdateRecord').form('submit', {
			onSubmit: function() {
				return $(this).form('enableValidation').form('validate');
			}
		});
		var boo = $('#tbUpdateRecord').form('validate');
		if(boo){
			$.ajax({
				type:"PUT",
				url:"http://localhost:8080/chatRecord",
				dataType:'JSON',
				data:$('#tbUpdateRecord').serialize(),
				success:function(data){
					$.messager.alert("提示",data.msg)
				}
			})
		}
	}
	
</script>
